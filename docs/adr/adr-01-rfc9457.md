<!--
doc_id: adr-01
title: ADR: RFC 9457 に準拠したエラー応答
version: 1.1.0
status: stable
source_template: docs/templates/adr-template.md
-->

# ADR: RFC 9457 に準拠したエラー応答

## 1. タイトル
- RFC 9457 に準拠したエラー応答の採用

## 2. ステータス
- 採用

## 3. 背景
1. `docs/analysis/analysis-01-roa.md` で、Web API のエラーメッセージは RFC 9457 に従う制約が追加された。
2. `docs/requirements/requirements-01-roa.md` のデータ契約でも、エラー応答の形式を明確化する必要がある。
3. 学習者が OpenAPI Specification を使った設計に進む前提として、標準化されたエラー表現を採用したい。

## 4. 決定
1. サンプル API のエラー応答は RFC 9457 (Problem Details for HTTP APIs) を採用する。
2. `Content-Type` は `application/problem+json` とし、`type` / `title` / `status` / `detail` / `instance` を必須とする。
3. 追加情報が必要な場合は RFC 9457 の拡張メンバーとして JSON に追加する（標準フィールド名とは衝突させない）。
4. HTML など非 JSON のエラー表現や独自エンベロープ形式はスコープ外とする。

## 5. 根拠
1. **標準性:** RFC 9457 は HTTP API の問題詳細を扱う標準であり、教材としての再現性が高い。
2. **学習価値:** エラー設計を OpenAPI の `responses` と一貫して説明できる。
3. **互換性:** 将来的な設計・実装の拡張時にも共通語彙として使える。
4. **代替案:**
   1) 独自の `code` / `message` 形式は、標準外で説明コストが増えるため却下。
   2) フレームワークのデフォルト応答は環境差が出るため却下。

## 6. 影響
- **ポジティブ:**
  1) エラー応答が一貫し、学習者が API 仕様と実装を対応付けやすくなる。
  2) OpenAPI Workshop の標準化指向と整合する。
- **ネガティブ:**
  1) `type` など追加項目の説明が必要になり、教材のボリュームが増える。
  2) 既存サンプルコードの更新が必要になる。
- **モニタリング:**
  1) 演習で作成した API が `application/problem+json` を返せているか確認する。
  2) アンケートでエラー設計の理解度を測定する。

## 7. 実施計画
1. サンプル API のエラーハンドリングを RFC 9457 に合わせて実装する。
2. OpenAPI 仕様に Problem Details のスキーマとレスポンス例を追加する。
3. 教材本文で Problem Details の目的と各フィールドの意味を説明する。
4. ロールバックが必要な場合は、最小限の `title` / `status` / `detail` のみを返す簡易版に縮退する。
5. 実装計画は `docs/plan/plan-01-roa.md` に追記する。

## 8. ステータス更新履歴
1. YYYY-MM-DD: 採用。判断根拠: `docs/analysis/analysis-01-roa.md` の RFC 9457 制約と `docs/requirements/requirements-01-roa.md` のデータ契約に整合するため。
